---
tags: whats-new
layout: whats-new-post.njk
permalink: whats-new/march_2019-update/index.html
summary: Hi all â€” it's been 464 commits since our last update post, and I hardly
  know where to start...
featuredImage: /assets/thing2.svg
categories:
  - news
authors:
  - arya-irani
date: 2019-03-29T00:00:00.000Z
title: March update
---

{% raw %}
<article class="unison-doc"><section><p></p><section><p><span class="span"><span class="word">Hi all â€” it's been 464 commits since our last update post, and I hardly know where to start...</span></span></p><p><span class="span"><span class="word">So, in arbitrary order:</span></span></p></section><section><h1 id="the-first-unison-meetup"><span class="span"><span class="word">The first Unison Meetup</span></span></h1><p><span class="span"><span class="word">...went off without a hitch! Join the</span><a href="https://www.meetup.com/Boston-Unison/" class="named-link" rel="noopener" target="_blank"><span class="span"><span class="word">Boston Unison meetup</span></span></a><span class="word">if you might like to come out to the next one. On Tuesday, about a dozen functional programming and future-of-computing enthusiasts gathered from around the greater Boston area to chat about their development experience, and let us show off our current progress, including:</span></span></p></section><section><h1 id="actually-editing-existing-code-"><span class="span"><span class="word">Actually editing existing code ðŸ˜…</span></span></h1><p><span class="span"><span class="word">The</span><span class="rich source inline-code"><code class="inline-code"><span class="word">edit</span></code></span><span class="word">command writes the text of the specified definition to disk for you to review or update.</span></span></p><img src="/assets/feed/march-2019-update/55251341-8fac5880-520d-11e9-9d74-9a6661e5f0bf.png" alt="I added the definitions to the top of meetup3.u"><p><span class="span"><span class="word">Once you're satisfied with your changes, you can use the</span><span class="rich source inline-code"><code class="inline-code"><span class="word">update</span></code></span><span class="word">command to replace an existing definition. (The usual</span><span class="rich source inline-code"><code class="inline-code"><span class="word">add</span></code></span><span class="word">command won't let you add a definition with an existing name.)</span></span></p><img src="/assets/feed/march-2019-update/55251578-2c6ef600-520e-11e9-81a4-4f09b40179d0.png" alt="I updated these definitions."><p><span class="word">Boom.</span></p></section><section><h1 id="structured-refactors"><span class="span"><span class="word">Structured Refactors</span></span></h1><p><span class="span"><span class="word">Gone are the days where changing a function signature produces a cascade of unhelpful error messages from across your entire project, where fixing one error causes seven more. Unison will support a number of structured refactorings, the first of which is simply:</span><span class="group"><span class="join"><span class="italic"><span class="span"><span class="word">definition replacement</span></span></span><span class="word">.</span></span></span></span></p><p><span class="span"><span class="word">In this example, I've updated the original</span><span class="rich source inline-code"><code class="inline-code"><span class="word">sliding</span></code></span><span class="word">function:</span></span></p><div class="rich source code unison"><pre><code><span class="word">sliding : Text -&gt; [Text]</span></code></pre></div><p><span class="span"><span class="word">to take an extra</span><span class="rich source inline-code"><code class="inline-code"><span class="word">width</span></code></span><span class="word">parameter, instead of hard-coding it:</span></span></p><div class="rich source code unison"><pre><code><span class="word">sliding : Nat -&gt; Text -&gt; [Text]</span></code></pre></div><img src="/assets/feed/march-2019-update/55250484-815d3d00-520b-11e9-9557-ef5d01eed85b.png" alt="This branch has 3 transitive dependents left to upgrade."><p><span class="span"><span class="word">From this output, we can see that this update has</span><span class="italic"><span class="word">three</span></span><span class="word">transitive dependents. This is the maximum number of definitions that you could need to audit or update as a result of the change. More importantly, this number only goes down as you work!</span></span></p><p><span class="span"><span class="word">Unison will recommend an ordering to your remaining updates, to minimize repeat work. (e.g. You if you updated</span><span class="group"><span class="join"><span class="rich source inline-code"><code class="inline-code"><span class="word">foo</span></code></span><span class="word">,</span></span></span><span class="word">and</span><span class="rich source inline-code"><code class="inline-code"><span class="word">bar</span></code></span><span class="word">depends on</span><span class="rich source inline-code"><code class="inline-code"><span class="word">foo</span></code></span><span class="word">and</span><span class="group"><span class="join"><span class="rich source inline-code"><code class="inline-code"><span class="word">baz</span></code></span><span class="word">,</span></span></span><span class="word">and</span><span class="rich source inline-code"><code class="inline-code"><span class="word">baz</span></code></span><span class="word">depends on</span><span class="group"><span class="join"><span class="rich source inline-code"><code class="inline-code"><span class="word">foo</span></code></span><span class="word">,</span></span></span><span class="word">Unison knows to recommend that you finish up</span><span class="rich source inline-code"><code class="inline-code"><span class="word">baz</span></code></span><span class="word">before updating</span><span class="group"><span class="join"><span class="rich source inline-code"><code class="inline-code"><span class="word">foo</span></code></span><span class="word">.)</span></span></span></span></p><p><span class="span"><span class="word">In my example, I only had to update</span><span class="italic"><span class="word">one</span></span><span class="word">dependent to finish. Because I didn't change its type, there was no more manual work to do:</span></span></p><img src="/assets/feed/march-2019-update/55250768-355ec800-520c-11e9-8236-f82dfea8559a.png" alt="No conflicts or edits in progress."><p><span class="span"><span class="word">If I had instead decided to pass the new parameter into</span><span class="rich source inline-code"><code class="inline-code"><span class="word">similarity</span></code></span><span class="word">as well, Unison knows there's more work to do, and guides me through the rest of that refactor:</span></span></p><img src="/assets/feed/march-2019-update/55251059-dea5be00-520c-11e9-9cfb-b6a26c429865.png" alt="This branch has 2 transitive dependents left to upgrade."><p><span class="span"><span class="word">For funsies, here are the replacements that Unison recorded:</span></span></p><img src="/assets/feed/march-2019-update/55251163-17de2e00-520d-11e9-8809-4f5993b57657.png" alt="Edited terms."></section><section><h1 id="a-shiny-new-runtime"><span class="span"><span class="word">A Shiny New Runtime</span></span></h1><p><span class="span"><span class="word">We've jettisoned the Scala-based runtime and replaced it with a simpler, Haskell-based IR compiler and interpreter. As well as putting us in a better position for optimizations going forward (IR to LLVM, etc.), it's allowed us to incorporate the runtime into the codebase editor, simplifying installation and execution as well. (One build tool, one executable.)</span></span></p><p><span class="span"><span class="word">Here we can see it, pretty-printing the result of partially applying a function:</span></span></p><img src="/assets/feed/march-2019-update/55251780-92f41400-520e-11e9-86db-e092c6847f63.png" alt="Watch expression for a partially-applied function."></section><section><h1 id="an-io-ability"><span class="span"><span class="word">An IO ability</span></span></h1><p><span class="span"><span class="word">We've added a</span><span class="group"><span class="join"><a href="https://github.com/unisonweb/unison/blob/ed69a95128440f7976014d2826a0e0872662ba43/parser-typechecker/src/Unison/Runtime/IOSource.hs#L194-L281" class="named-link" rel="noopener" target="_blank"><span class="span"><span class="word">preliminary</span><span class="rich source inline-code"><code class="inline-code"><span class="word">IO</span></code></span><span class="word">ability</span></span></a><span class="word">,</span></span></span><span class="word">and are in the process of implementing a native handler for it in the runtime.</span></span></p><p><span class="span"><span class="word">We have also added the</span><span class="rich source inline-code"><code class="inline-code"><span class="word">execute</span></code></span><span class="word">command to the codebase editor, which will evaluate</span><span class="rich source inline-code"><code class="inline-code"><span class="word">IO</span></code></span><span class="word">expressions, such as your application. Eventually, you'll be able to start your application from the shell as well, by passing command-line arguments.</span></span></p><img src="/assets/feed/march-2019-update/55258190-63013c80-521f-11e9-8853-ca10aaa8bd05.png" alt="Hello, world!"></section><section><h1 id="a-data-type"><span class="span"><span class="word">A</span><span class="rich source inline-code"><code class="inline-code"><span class="word">Bytes</span></code></span><span class="word">data type</span></span></h1><p><span class="span"><span class="word">The</span><span class="rich source inline-code"><code class="inline-code"><span class="word">IO</span></code></span><span class="word">functions will likely use this eventually!</span></span></p><img src="/assets/feed/march-2019-update/54630653-b968c100-4a50-11e9-9200-2a96e6ff6a03.png" alt="Bytes demo"><section><h2 id="universal-comparison"><span class="span"><span class="word">Universal comparison</span></span></h2><div class="rich source code unison"><pre><code><span class="word">Universal.&lt; : a -&gt; a -&gt; Boolean
Universal.&lt;= : a -&gt; a -&gt; Boolean
Universal.== : a -&gt; a -&gt; Boolean
Universal.&gt; : a -&gt; a -&gt; Boolean
Universal.&gt;= : a -&gt; a -&gt; Boolean
Universal.compare : a -&gt; a -&gt; Int</span></code></pre></div><p><span class="span"><span class="word">The implementation works for all types, comparing values structurally. Even functions! We will probably do something in the future to give these a more constrained type and get our free theorems back.</span></span></p><p><span class="span"><span class="word">At any rate, given:</span></span></p><div class="rich source code unison"><pre><code><span class="word">use Universal ==
foo a b = a Nat.* b
bar x y = x Nat.* y
&gt; 1 == 2
&gt; (5,5) == (5,5)
&gt; foo == bar
&gt; foo 1 == bar 1
&gt; foo 1 == bar 2
&gt; foo 1 &lt; bar 2</span></code></pre></div><p><span class="span"><span class="word">we get:</span></span></p><img src="/assets/feed/march-2019-update/55260307-4536d600-5225-11e9-818f-03d0876ae230.png" alt="Universal Eq/Ord demo"><p><span class="span"><span class="word">Not bad!</span></span></p></section></section><section><h1 id="bugfixes"><span class="word">Bugfixes</span></h1><p><span class="span"><span class="word">We've fixed a lot of bugs. ðŸ˜… Thank you to the masochistic handful who've been using the tool and reporting them, and special thanks to @noahaasis (</span><a href="https://github.com/unisonweb/unison/pull/328" class="named-link" rel="noopener" target="_blank"><span class="word">#328</span></a><span class="word">), @francisdb (</span><span class="group"><span class="join"><a href="https://github.com/unisonweb/unison/pull/333" class="named-link" rel="noopener" target="_blank"><span class="word">#333</span></a><span class="word">,</span></span></span><a href="https://github.com/unisonweb/unison/pull/392" class="named-link" rel="noopener" target="_blank"><span class="word">#392</span></a><span class="word">) , @mrziuban (</span><span class="group"><span class="join"><a href="https://github.com/unisonweb/unison/pull/382" class="named-link" rel="noopener" target="_blank"><span class="word">#382</span></a><span class="word">,</span></span></span><a href="https://github.com/unisonweb/unison/pull/385" class="named-link" rel="noopener" target="_blank"><span class="word">#385</span></a><span class="word">), @benfradet (</span><a href="https://github.com/unisonweb/unison/pull/418" class="named-link" rel="noopener" target="_blank"><span class="word">#418</span></a><span class="word">), for their fixes.</span></span></p></section><section><h1 id="unison-related-projects"><span class="span"><span class="word">Unison-Related Projects</span></span></h1><p><span class="span"><span class="word">Discovering new Unison projects in the wild has been super gratifying. Here are two:</span></span></p><ul><li><ul class="column"><li><a href="https://github.com/francisdb/unison-json" class="named-link" rel="noopener" target="_blank"><span class="word">https://github.com/francisdb/unison-json</span></a></li><li><ul><li><span class="span"><span class="word">JSON AST / parser / printer, written in Unison.</span></span></li></ul></li></ul></li><li><ul class="column"><li><a href="https://github.com/BenFradet/vscode-unison" class="named-link" rel="noopener" target="_blank"><span class="word">https://github.com/BenFradet/vscode-unison</span></a></li><li><ul><li><span class="span"><span class="word">Unison syntax highlighting for VS Code.</span></span></li></ul></li></ul></li></ul></section><section><h1 id="whats-up-next"><span class="span"><span class="word">What's up next?</span></span></h1><p><span class="span"><span class="word">The most immediate next steps towards the M1 release of the codebase editor include:</span></span></p><section><h2 id="more-io"><span class="span"><span class="word">More I/O!</span></span></h2><p><span class="span"><span class="word">File I/O! Network I/O! Concurrency! Universal</span><span class="group"><span class="join"><span class="rich source inline-code"><code class="inline-code"><span class="word">toString</span></code></span><span class="word">?</span></span></span><span class="word">ðŸ¤”</span></span></p></section><section><h2 id="more-types-of-types"><span class="span"><span class="word">More types of types!</span></span></h2><p><span class="span"><span class="word">Today, any two Unison types are the same if the (multi)set of their constructor types is the same. We'll be introducing new-types and opaque types.</span></span></p></section><section><h2 id="more-codebase-editor-work"><span class="span"><span class="word">More Codebase Editor work!</span></span></h2><p><span class="span"><span class="word">There are so many rough edges, but we'll get them one by one.</span></span></p></section></section><section><h1 id="thats-all-for-now"><span class="span"><span class="word">That's all for now.</span></span></h1><p><span class="span"><span class="word">Thanks for reading, and keep the comments coming! Especially, let us know what you need to start your Unison-based project.</span></span></p></section></section><div class="tooltips" style="display: none;"></div></article>
{% endraw %}
