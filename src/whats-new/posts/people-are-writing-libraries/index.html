---
tags: whats-new
layout: whats-new-post.njk
permalink: whats-new/people-are-writing-libraries/index.html
summary: It's exciting to see Unison gradually coming together, but even more
  exciting has been seeing people writing and publishing Unison code. I've been
  pretty busy reviewing pull requests to the Unison base libraries and there's
  already a lot of useful stuff there. Thanks to everyone who has contributed so
  far!
featuredImage: /assets/thing14.svg
categories:
  - news
authors:
  - runar-bjarnason
date: 2020-05-26T00:00:00.000Z
title: People are writing Unison libraries now
---

{% raw %}
<article class="unison-doc"><section><p></p><section><p><span class="span"><span class="word">Last week we released another Unison alpha milestone. This release has a</span><span class="group"><span class="join"><a href="https://github.com/unisonweb/unison/releases/tag/release%2FM1m" class="named-link" rel="noopener" target="_blank"><span class="span"><span class="word">number of bugfixes and performance improvements</span></span></a><span class="word">.</span></span></span><span class="word">üåà‚≠êÔ∏è</span></span></p><p><span class="span"><span class="word">It's exciting to see Unison gradually coming together, but even more exciting has been seeing people writing and publishing Unison code. I've been pretty busy reviewing pull requests to the</span><span class="group"><span class="join"><a href="http://github.com/unisonweb/base" class="named-link" rel="noopener" target="_blank"><span class="span"><span class="word">Unison base libraries</span></span></a><span class="word">,</span></span></span><span class="word">and there's already a lot of useful stuff there. Thanks to everyone who has contributed so far!</span></span></p><p><span class="span"><span class="word">A number of folks have been working on their own Unison libraries and we're collecting these</span><span class="group"><span class="join"><a href="https://www.unisonweb.org/docs/libraries/" class="named-link" rel="noopener" target="_blank"><span class="span"><span class="word">on a page of this site</span></span></a><span class="word">.</span></span></span><span class="word">I want to highlight just one of these, which is a random number generator. There are many other cool libraries, but I picked this one at random. The main thing I want to highlight is just how easy it is to create and use Unison libraries.</span></span></p><section><h2 id="starting-up"><span class="span"><span class="word">Starting up</span></span></h2><p><span class="span"><span class="word">If you've been putting off trying out Unison because you think getting into a new language might be a lot of work and involve a lot of setup, then I've got good news for you: Unison requires almost no setup. You can just start coding.</span></span></p><p><span class="span"><span class="word">To get going with Unison, you can go through the</span><span class="group"><span class="join"><a href="https://www.unisonweb.org/docs/quickstart/" class="named-link" rel="noopener" target="_blank"><span class="span"><span class="word">three minute quickstart guide</span></span></a><span class="word">.</span></span></span><span class="word">It only has three steps.</span></span></p><p><span class="span"><span class="word">Once set up,</span><span class="rich source inline-code"><code class="inline-code"><span class="word">ucm</span></code></span><span class="word">starts the Unison Codebase Manager:</span></span></p><img src="/assets/feed/people-are-writing-libraries/image-20200520213314979.png" alt="Unison Codebase Manager"><p><span class="span"><span class="word">I can now just start writing Unison code in any file in the directory from which I started</span><span class="group"><span class="join"><span class="rich source inline-code"><code class="inline-code"><span class="word">ucm</span></code></span><span class="word">,</span></span></span><span class="word">as long as that file's name ends in</span><span class="group"><span class="join"><span class="rich source inline-code"><code class="inline-code"><span class="word">.u</span></code></span><span class="word">.</span></span></span><span class="word">I open up a file</span><span class="rich source inline-code"><code class="inline-code"><span class="word">scratch.u</span></code></span><span class="word">with</span><span class="rich source inline-code"><code class="inline-code"><span class="word">vim</span></code></span><span class="word">(my favorite editor), and write my first definition, the obligatory</span><span class="rich source inline-code"><code class="inline-code"><span class="word">factorial</span></code></span><span class="word">function:</span></span></p><div class="rich source code unison"><pre><code><span class="word">factorial n = List.foldr (*) 1 (range 2 (n + 1))</span></code></pre></div><p><span class="span"><span class="word">If I save my scratch file, Unison responds with:</span></span></p><img src="/assets/feed/people-are-writing-libraries/image-20200520215259737.png" alt="ucm output: factorial"><p><span class="span"><span class="word">It's telling me that</span><span class="rich source inline-code"><code class="inline-code"><span class="word">factorial</span></code></span><span class="word">is a function that takes a</span><span class="rich source inline-code"><code class="inline-code"><span class="word">Nat</span></code></span><span class="word">(a 64-bit unsigned integer), and returns another</span><span class="group"><span class="join"><span class="rich source inline-code"><code class="inline-code"><span class="word">Nat</span></code></span><span class="word">.</span></span></span><span class="word">I can add this function to my codebase:</span></span></p><img src="/assets/feed/people-are-writing-libraries/image-20200520223126406.png" alt="Adding factorial to codebase"><p><span class="span"><span class="word">I can try out my function right in the scratch file by adding a "watch expression", which is any line that starts with</span><span class="rich source inline-code"><code class="inline-code"><span class="word">&gt;</span></code></span><span class="word">(or an indentation block where the first line starts with</span><span class="group"><span class="join"><span class="rich source inline-code"><code class="inline-code"><span class="word">&gt;</span></code></span><span class="word">).</span></span></span></span></p><div class="rich source code unison"><pre><code><span class="word">&gt; factorial 10</span></code></pre></div><p><span class="span"><span class="word">Unison reponds by evaluating my expression:</span></span></p><img src="/assets/feed/people-are-writing-libraries/image-20200520215820928.png" alt="watch expreission"></section><section><h2 id="looking-around-the-base-library"><span class="span"><span class="word">Looking around the base library</span></span></h2><p><span class="span"><span class="word">The</span><span class="rich source inline-code"><code class="inline-code"><span class="word">base</span></code></span><span class="word">library is already full of good stuff, with new things being added almost daily now. To see what's here, I can browse with UCM. If I do</span><span class="rich source inline-code"><code class="inline-code"><span class="word">list .base</span></code></span><span class="word">(or</span><span class="group"><span class="join"><span class="rich source inline-code"><code class="inline-code"><span class="word">ls .base</span></code></span><span class="word">),</span></span></span><span class="word">I get a long list. I can</span><span class="rich source inline-code"><code class="inline-code"><span class="word">cd</span></code></span><span class="word">into any namespace and look around with</span><span class="group"><span class="join"><span class="rich source inline-code"><code class="inline-code"><span class="word">ls</span></code></span><span class="word">.</span></span></span></span></p><p><span class="span"><span class="word">In the definition of</span><span class="rich source inline-code"><code class="inline-code"><span class="word">factorial</span></code></span><span class="word">above, I was using</span><span class="rich source inline-code"><code class="inline-code"><span class="word">foldr</span></code></span><span class="word">and</span><span class="group"><span class="join"><span class="rich source inline-code"><code class="inline-code"><span class="word">range</span></code></span><span class="word">.</span></span></span><span class="word">If I ask UCM to</span><span class="group"><span class="join"><span class="rich source inline-code"><code class="inline-code"><span class="word">find range</span></code></span><span class="word">,</span></span></span><span class="word">it responds with everything it knows about with</span><span class="rich source inline-code"><code class="inline-code"><span class="word">range</span></code></span><span class="word">in the name:</span></span></p><img src="/assets/feed/people-are-writing-libraries/image-20200520223808394.png" alt="find range"><p><span class="span"><span class="word">The second entry is the function I was using,</span><span class="group"><span class="join"><span class="rich source inline-code"><code class="inline-code"><span class="word">List.range</span></code></span><span class="word">.</span></span></span><span class="word">I can ask for its definition either by name or by using the number from the list that UCM produced:</span></span></p><img src="/assets/feed/people-are-writing-libraries/image-20200520224130827.png" alt="view range"><p><span class="span"><span class="word">The</span><span class="rich source inline-code"><code class="inline-code"><span class="word">docs</span></code></span><span class="word">command (try</span><span class="group"><span class="join"><span class="rich source inline-code"><code class="inline-code"><span class="word">help docs</span></code></span><span class="word">)</span></span></span><span class="word">shows me the documentation for a given function or type, if it has any docs associated with it.</span></span></p><img src="/assets/feed/people-are-writing-libraries/image-20200520224626845.png" alt="docs"></section><section><h2 id="lets-have-a-look-at-a-third-party-library"><span class="span"><span class="word">Let's have a look at a third-party library</span></span></h2><p><span class="span"><span class="word">Looking at the</span><span class="group"><span class="join"><a href="https://www.unisonweb.org/docs/libraries/" class="named-link" rel="noopener" target="_blank"><span class="span"><span class="word">list of libraries that people have already made</span></span></a><span class="word">,</span></span></span><span class="word">I want to pick one, kind of at random, and just play with it to give you a feel for what it's like to consume libraries in Unison. And speaking of random, it looks like one of them is</span><span class="group"><span class="join"><a href="https://github.com/atacratic/unison-random-mersenne" class="named-link" rel="noopener" target="_blank"><span class="span"><span class="word">a random number generator that uses a Mersenne twister</span></span></a><span class="word">,</span></span></span><span class="word">written by Chris Gibbs. Let's try that out.</span></span></p><p><span class="span"><span class="word">Chris has supplied handy install instructions, so let's just do as he says:</span></span></p><div class="rich source code ucm"><pre><code><span class="word">.&gt; pull https://github.com/atacratic/unison-random-mersenne.git:.releases._v1 external.unison_random_mersenne.v1</span></code></pre></div><p><span class="span"><span class="word">Lots of stuff scrolls by, and Chris's library is now in my codebase. The namespace</span><span class="rich source inline-code"><code class="inline-code"><span class="word">external.unison_random_mersenne.v1</span></code></span><span class="word">is kind of long for my taste, so I'm just going to move it under</span><span class="group"><span class="join"><span class="rich source inline-code"><code class="inline-code"><span class="word">lib.rng</span></code></span><span class="word">.</span></span></span></span></p><div class="rich source code ucm"><pre><code><span class="word">.&gt; move.namespace external.unison_random_mersenne.v1 lib.rng</span></code></pre></div><p><span class="span"><span class="word">I'm using tab completion for this instead of typing out the whole thing. I</span><span class="rich source inline-code"><code class="inline-code"><span class="word">cd lib.rng</span></code></span><span class="word">and look around.</span></span></p><img src="/assets/feed/people-are-writing-libraries/image-20200520233757131.png" alt="cd lib.rng"><p><span class="span"><span class="word">Looks like there's a</span><span class="group"><span class="join"><span class="rich source inline-code"><code class="inline-code"><span class="word">README</span></code></span><span class="word">,</span></span></span><span class="word">which is a Unison value of type</span><span class="group"><span class="join"><span class="rich source inline-code"><code class="inline-code"><span class="word">Doc</span></code></span><span class="word">.</span></span></span><span class="word">I can ask UCM to render any</span><span class="rich source inline-code"><code class="inline-code"><span class="word">Doc</span></code></span><span class="word">with the</span><span class="rich source inline-code"><code class="inline-code"><span class="word">display</span></code></span><span class="word">command. In the</span><span class="rich source inline-code"><code class="inline-code"><span class="word">README</span></code></span><span class="word">there's a usage example which shows me how to generate some random numbers.</span></span></p><p><span class="span"><span class="word">I put a triple dash</span><span class="group"><span class="join"><span class="rich source inline-code"><code class="inline-code"><span class="word">---</span></code></span><span class="word">,</span></span></span><span class="word">a "fold", on a line at the top of my</span><span class="rich source inline-code"><code class="inline-code"><span class="word">scratch.u</span></code></span><span class="word">file, which tells Unison to ignore everything below. I've already added</span><span class="rich source inline-code"><code class="inline-code"><span class="word">factorial</span></code></span><span class="word">to my codebase, so I don't need to think about that anymore. It goes below the fold. Above the fold, I put an expression to generate a single random number between 0 and 10 which I got from the README.</span></span></p><div class="rich source code unison"><pre><code><span class="word">&gt; mersenne.provide (nextFromRange 0 11) defaultSeed 'ask
---
factorial n = List.foldr (*) 1 (range 2 (n + 1))</span></code></pre></div><p><span class="span"><span class="word">I wonder what this</span><span class="rich source inline-code"><code class="inline-code"><span class="word">mersenne.provide</span></code></span><span class="word">is. Let's ask Unison.</span></span></p><img src="/assets/feed/people-are-writing-libraries/image-20200522075051047.png" alt="mersenne.provide"><p><span class="span"><span class="word">OK, so</span><span class="rich source inline-code"><code class="inline-code"><span class="word">provide</span></code></span><span class="word">generates numbers by providing a</span><span class="rich source inline-code"><code class="inline-code"><span class="word">Store State</span></code></span><span class="word">ability, where</span><span class="rich source inline-code"><code class="inline-code"><span class="word">State</span></code></span><span class="word">is the Mersenne twister's internal state. The</span><span class="rich source inline-code"><code class="inline-code"><span class="word">Nat32</span></code></span><span class="word">is the seed, and this</span><span class="rich source inline-code"><code class="inline-code"><span class="word">Ask n</span></code></span><span class="word">thing is a computation that can ask for a random</span><span class="rich source inline-code"><code class="inline-code"><span class="word">n</span></code></span><span class="word">(which in my case is going to be</span><span class="group"><span class="join"><span class="rich source inline-code"><code class="inline-code"><span class="word">Nat</span></code></span><span class="word">).</span></span></span></span></p><p><span class="span"><span class="word">Looks like this library puts a lot of its guts on display, so I'm going to try to write a more abstract interface for it. What I really want for a random number generator ability is something like this:</span></span></p><div class="rich source code unison"><pre><code><span class="word">ability RNG where
  nextNat : Nat</span></code></pre></div><p><span class="span"><span class="word">I can write a (recursive) handler for this ability that uses the Mersenne twister:</span></span></p><div class="rich source code unison"><pre><code><span class="word">mersenneRNG : Nat32 -&gt; '{RNG,e} a -&gt;{e} a
mersenneRNG seed x =
  h = cases
    { nextNat -&gt; k } -&gt; handle (k !nat.next) with h
    { a } -&gt; a
  mersenne.provide '(handle !x with h) seed 'ask</span></code></pre></div><p><span class="span"><span class="word">Great! So now I can request a random</span><span class="rich source inline-code"><code class="inline-code"><span class="word">Nat</span></code></span><span class="word">just by saying</span><span class="group"><span class="join"><span class="rich source inline-code"><code class="inline-code"><span class="word">nextNat</span></code></span><span class="word">,</span></span></span><span class="word">and I can handle that request with `mersenneRNG`by providing a seed. But sometimes I don't want to provide a seed, and I just want to generate a random number as an</span><span class="rich source inline-code"><code class="inline-code"><span class="word">IO</span></code></span><span class="word">effect. Let's try to feed it the system time.</span></span></p><img src="/assets/feed/people-are-writing-libraries/image-20200522100603772.png" alt="system type"><p><span class="span"><span class="word">OK, we can get an</span><span class="group"><span class="join"><span class="rich source inline-code"><code class="inline-code"><span class="word">EpochTime</span></code></span><span class="word">,</span></span></span><span class="word">which wraps a</span><span class="group"><span class="join"><span class="rich source inline-code"><code class="inline-code"><span class="word">Nat</span></code></span><span class="word">,</span></span></span><span class="word">using</span><span class="group"><span class="join"><span class="rich source inline-code"><code class="inline-code"><span class="word">systemTime</span></code></span><span class="word">.</span></span></span><span class="word">Can we turn that into a</span><span class="rich source inline-code"><code class="inline-code"><span class="word">Nat32</span></code></span><span class="word">as required by</span><span class="group"><span class="join"><span class="rich source inline-code"><code class="inline-code"><span class="word">mersenneRNG</span></code></span><span class="word">?</span></span></span><span class="word">A type-based</span><span class="rich source inline-code"><code class="inline-code"><span class="word">find</span></code></span><span class="word">turns up 3 different functions:</span></span></p><img src="/assets/feed/people-are-writing-libraries/image-20200522100821121.png" alt="type based find"><p><span class="span"><span class="word">Skimming the</span><span class="rich source inline-code"><code class="inline-code"><span class="word">docs</span></code></span><span class="word">for these, I see that</span><span class="rich source inline-code"><code class="inline-code"><span class="word">truncate32</span></code></span><span class="word">is probably the thing I want. It truncates the high 32 bits, leaving me with just the least significant bits of the clock. So I write:</span></span></p><div class="rich source code unison"><pre><code><span class="word">clockSeed : '{IO} Nat32
clockSeed _ =
  match !systemTime with
    EpochTime t -&gt; truncate32 t</span></code></pre></div><p><span class="span"><span class="word">And finally I use the</span><span class="rich source inline-code"><code class="inline-code"><span class="word">mersenneRNG</span></code></span><span class="word">handler from earlier:</span></span></p><div class="rich source code unison"><pre><code><span class="word">mersenneIO : '{RNG,e} a -&gt;{IO,e} a
mersenneIO x =
  mersenneRNG !clockSeed x</span></code></pre></div><p><span class="span"><span class="word">An example of using this in a program might be:</span></span></p><div class="rich source code unison"><pre><code><span class="word">main : '{IO} ()
main = 'let
  printLine (Nat.toText (mersenneIO 'nextNat))</span></code></pre></div><p><span class="span"><span class="word">I</span><span class="rich source inline-code"><code class="inline-code"><span class="word">add</span></code></span><span class="word">all of that to a</span><span class="rich source inline-code"><code class="inline-code"><span class="word">scratch</span></code></span><span class="word">namespace in my codebase:</span></span></p><img src="/assets/feed/people-are-writing-libraries/image-20200522101957081.png" alt="add to scratch namespace"><p><span class="span"><span class="word">Let's try to run it. UCM provides a</span><span class="rich source inline-code"><code class="inline-code"><span class="word">run</span></code></span><span class="word">command which provide the</span><span class="rich source inline-code"><code class="inline-code"><span class="word">IO</span></code></span><span class="word">ability to something of a type like</span><span class="group"><span class="join"><span class="rich source inline-code"><code class="inline-code"><span class="word">'{IO} a</span></code></span><span class="word">.</span></span></span></span></p><img src="/assets/feed/people-are-writing-libraries/image-20200522102323333.png" alt="run"><p><span class="span"><span class="word">Great! I got a random number using the system clock time as a seed. Maybe at some point I'll</span><a href="https://www.unisonweb.org/docs/codebase-organization/#day-to-day-development-creating-and-merging-pull-requests" class="named-link" rel="noopener" target="_blank"><span class="span"><span class="word">send a pull request</span></span></a><span class="word">to Chris so he can incorporate some of this into his library.</span></span></p></section><section><h2 id="conclusion"><span class="word">Conclusion</span></h2><p><span class="span"><span class="word">I hope this gives you a taste of what it's like to work in Unison with the current alpha release, and that this encourages you to try it out and maybe contribute some libraries. Remember, it's early days yet, so little things you build now could make a big impact on the Unison community for the future.</span></span></p></section></section></section><div class="tooltips" style="display: none;"></div></article>
{% endraw %}
